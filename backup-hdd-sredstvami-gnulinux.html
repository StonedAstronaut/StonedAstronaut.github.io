<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
        <title>Backup hdd средствами GNU/Linux</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="https://stonedastronaut.github.io/theme/css/style.css" type="text/css" />
        <link href="https://stonedastronaut.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Astro blog ATOM Feed" />
    </head>
    <body>
    <h1>Backup hdd средствами GNU/Linux</h1>
    <div class="info">
     By <a class="url fn" href="#">Petr Kalmykov</a>
     on <a></a>
     about <a href="https://stonedastronaut.github.io/category/misc.html">misc</a>
    </div>
    <p>После теста hdd можно определить, пора ли менять диск или нет.</p>
<p>Если время пришло, то тогда необходимо перенести со старого жесткого всю инфу на новый.</p>
<p>Из гуглежа, стало ясно, чо использование обычного dd не "кошегно". Ъ использовать <strong>GNU ddrescue</strong>. Команда для backup'а выглядит следующим образом:</p>
<div class="highlight"><pre><span class="c"># ddrescue /dev/sdX /pth_to_backup/disk.img /pth_to_backup/disk.img.log</span>
</pre></div>


<p>Можно делать backup как раздела, так и всего hdd.</p>
<p>Для просмотра содержимого <strong>раздела</strong> используем следующую команду:</p>
<div class="highlight"><pre><span class="c"># mount -o loop /pth_to_backup/drive.img /mnt</span>
</pre></div>


<p>А для <strong>образа физического диска</strong>:</p>
<div class="highlight"><pre><span class="c"># losetup --partscan /dev/loop0 drive.img</span>
<span class="c"># mount /dev/loop0p2 /mnt</span>
</pre></div>


<p>или,</p>
<div class="highlight"><pre><span class="c"># kpartx -a /dev/loop0 drive.img</span>
<span class="c"># mount /dev/mapper/loop0p2 /mnt</span>
</pre></div>


<p>в зависимости от дистра.</p>
<p>Восстановление из образа:</p>
<div class="highlight"><pre><span class="c"># ddrescue --force disk.img /dev/sdxX disk.img.log</span>
</pre></div>


<p>!!!<strong>раздел на который идет восстановление должен быть <em>НЕ</em> меньше файла-образа</strong></p>
<p>стырено <a href="http://habrahabr.ru/post/233961/">изхабра</a></p>

    <div class="copyright info vcard">Design by <a class="fn url"
    href="http://martyalchin.com">Marty Alchin</a>, <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/us/">some rights reserved</a>. Powered by <a href="http://alexis.notomyidea.org/pelican/">pelican</a></div>
    </body>
</html>